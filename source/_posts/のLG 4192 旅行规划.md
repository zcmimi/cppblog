---
author: zc
avatar: null
categories:
- - 刷题记录
commnet: 1
date: 2020-07-10 18:50
html: '<details><summary>查看原题</summary><div id=''from''></div><p><button onclick="document.getElementById(''from'').innerHTML=''<iframe
  src=&quot;https://www.luogu.com.cn/problem/P4192&quot; width=100% height=800px style=&quot;border:
  none;&quot;><iframe>''" class=''mdui-btn mdui-btn-raised mdui-ripple''>点击加载</button><a
  class=''mdui-btn mdui-btn-raised mdui-ripple'' href="https://www.luogu.com.cn/problem/P4192"
  target=''_blank''>点击跳转</a><p></details>'
permalink: LG 4192 旅行规划
tags: []
thumbnail: null
title: LG 4192 旅行规划
top: 0

---

```cpp
#include<bits/stdc++.h>
int max(int x,int y){return x>y?x:y;}
int rd(){int x=0;char c;bool f=0;for(c=getchar();c<'0'||'9'<c;c=getchar())f^=c=='-';for(x=c-48,c=getchar();'0'<=c&&c<='9';x=x*10+c-48,c=getchar());return f?-x:x;}
const int N=100011;
int n,laz[N<<2];
struct node{
    int s,S;
    void init(int v){S=max(0,s=v);}
}s[N<<2];
node operator+(node x,node y){
    node c;
    c.s=x.s+y.s;
    c.S=max(x.S,x.s+y.S);
    return c;
}
#define ls rt<<1
#define rs rt<<1|1
void build(int l,int r,int rt){
    if(l==r){s[rt].init(rd());return;}
    int m=l+r>>1;
    build(l,m,ls),build(m+1,r,rs);
    s[rt]=s[ls]+s[rs];
}
void pd(int rt,int ln,int rn){
    if(laz[rt]){
        s[ls].init(laz[rt]*ln),
        s[rs].init(laz[rt]*rn);
        laz[ls]+=laz[rt],
        laz[rs]+=laz[rt];
        laz[rt]=0;
    }
}
void upd(int L,int R,int v,int l,int r,int rt){
    if(L<=l&&r<=R){
        s[rt].init(v*(r-l+1));
        laz[rt]+=v;
        return;
    }
    int m=l+r>>1;
    pd(rt,m-l+1,r-m);
    if(L<=m)upd(L,R,v,l,m,ls);
    if(R>m)upd(L,R,v,m+1,r,rs);
    s[rt]=s[ls]+s[rs];
}
node ask(int L,int R,int l,int r,int rt){
    if(L==l&&r==R)return s[rt];
    int m=l+r>>1;
    pd(rt,m-l+1,r-m);
    if(L>m)return ask(L,R,m+1,r,rs);
    if(R<=m)return ask(L,R,l,m,ls);
    return ask(L,m,l,m,ls)+ask(m+1,R,m+1,r,rs);
}
int main(){
    build(1,n=rd(),1);
    for(int q=rd();q--;){
        int opt=rd(),x=rd(),y=rd();
        if(opt==1)printf("%d\n",ask(x,y,1,n,1).S);
        else upd(x,y,rd(),1,n,1);
    }
}
```
